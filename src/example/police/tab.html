<!--旅店信息-->
<div class="page">
    <div class="page__bd bg-page">
        <div class="weui-tab">
            <div class="weui-navbar">
                <div class="weui-navbar__item weui-bar__item_on" href="#tab1">未完成</div>
                <div class="weui-navbar__item" href="#tab2">已完成</div>
            </div>
            <div class="weui-tab__panel">
                <div class="weui-cells"  id="tab1">
                    <div class="weui-cell bg-cell">
                    <div class="header-img">禧龙</div>
                    <div class="weui-cell__bd cell_bd_border" data-id="Unfinished_detail" >
                            <p class="left-cell">
                                哈尔滨禧龙宾馆(先锋路店)
                            </p>
                            <div class="weui-cell__ft cell_fs left-cell">
                                15:56:20 pm
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weui-cells active"  id="tab2">
                    <div class="weui-cell bg-cell">
                    <div class="header-img">金芒果</div>
                    <div class="weui-cell__bd cell_bd_border" data-id="Finished_detail">
                        <p class="left-cell">
                            哈尔滨市金芒果快捷宾馆
                        </p>
                        <div class="weui-cell__ft cell_fs left-cell">
                            15:56:20 pm
                        </div>
                    </div>
                    </div>
                </div>
            </div>
            <div class="weui-loadmore">
                <i class="weui-loading"></i>
                <span class="weui-loadmore__tips">正在加载</span>
            </div>
            <!--<div class="weui-loadmore weui-loadmore_line">-->
                <!--<span class="weui-loadmore__tips">暂无数据</span>-->
            <!--</div>-->
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        $('.weui-navbar__item').on('click', function () {
            $(this).addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
        });
        $(".weui-navbar div").click(function() {
            $(".weui-cells").hide();
            var activeTab = $(this).attr("href");
            $(activeTab).fadeIn();
            return false;
        });
        $('.weui-cell__bd').on('click', function(){
            var id = $(this).data('id');
            window.pageManager.go(id);
        });
        $.ajax({
            type: "POST",
            url: "api/task.json",
            async: true,
            success: function (data) {
                console.log("success")
                lists();
            },
            error: function (mes) {
                console.log('error');
            }
        });
//页面自动加载列表
//        var gPageSize = 10;
//        var i = 1;
//        function getData(pagenumber) {
//            i++; //页码自动增加，保证下次调用时为新的一页。
//            $.get("api/task.json", { pagesize: gPageSize, pagenumber: pagenumber }, function (data) {
//                if (data.length > 0) {
//                    var jsonObj = JSON.parse(data);
//                    insertDiv(jsonObj);
//                }
//            });
//            $.ajax({
//                type: "POST",
//                url: "api/task.json",
//                data: { pagesize: gPageSize, pagenumber: pagenumber },
//                dataType: "json",
//                success: function (data) {
//                    $(".weui-loadmore").hide();
//                    if (data.length > 0) {
//                        var jsonObj = JSON.parse(data);
//                        insertDiv(jsonObj);
//                    }
//                },
//                beforeSend: function () {
//                    $(".weui-loadmore").show();
//                },
//                error: function () {
//                    $(".weui-loadmore").hide();
//                }
//            });
//        }
//        //初始化加载第一页数据
//        getData(1);
//        //生成数据append到div中
//        function insertDiv(json) {
//            for (i = 0; i <= json.length; i++) {
//                $('#tab1').append(
//                        '<div class="weui-cell bg-cell">' +
//                            '<div class="header-img">' + '禧龙' + '</div>' +
//                            '<div class="weui-cell__bd cell_bd_border" data-id="Unfinished_detail" >' +
//                                '<p class="left-cell">' +
//                                json[i].hotelName +
//                                '</p>' +
//                                '<div class="weui-cell__ft cell_fs left-cell">' +
//                                json[i].createTime +
//                                '</div>' +
//                            '</div>' +
//                        '</div>'
//                )
//            }
//            //到达底部加载
//            var winH = $(window).height(); //页面可视区域高度
//            var scrollHandler = function () {
//                var pageH = $(document.body).height();
//                var scrollT = $(window).scrollTop();
//                var aa = (pageH - winH - scrollT) / winH;
//                if (aa < 0.02) {
//                    getData(i);
//                    if (i % 10 === 0) {//每10页做一次停顿
//                        $(window).scroll(scrollHandler);
//                    }
//                }
//            }
//            //定义鼠标滚动事件
//            $(window).scroll(scrollHandler);
//        }

        function lists() {
            var Times = new Date( data[i].createTime ) ;
            commonTime = Times.toLocaleString();
            for(i=0;i<=data.length;i++) {
                $('#tab1').append(
                        '<div class="weui-cell bg-cell">' +
                            '<div class="header-img">' + '禧龙' + '</div>' +
                            '<div class="weui-cell__bd cell_bd_border" data-id="Unfinished_detail" >' +
                                '<p class="left-cell">' +
                                    data[i].hotelName +
                                '</p>' +
                                '<div class="weui-cell__ft cell_fs left-cell">' +
                                    commonTime +
                                '</div>' +
                            '</div>' +
                        '</div>'
                )
                $('#tab2').append(
                        '<div class="weui-cell bg-cell">' +
                            '<div class="header-img">' + '金芒果' + '</div>' +
                            '<div class="weui-cell__bd cell_bd_border" data-id="Finished_detail">' +
                                '<p class="left-cell">' +
                                    data[i].hotelName +
                                '</p>' +
                                '<div class="weui-cell__ft cell_fs left-cell">' +
                                    data[i].createTime +
                                '</div>' +
                            '</div>' +
                        '</div>'
                )
                $('.weui-cell__bd').bind('click', function () {
                    var id = $(this).data('id');
                    window.pageManager.go(id);
                });
            }
        }
    });

</script>



<!--旅店信息-->
<div class="page">
    <div class="page__bd bg-page">
        <div class="weui-tab">
            <div class="weui-navbar">
                <div class="weui-navbar__item weui-bar__item_on" href="#tab1">未完成</div>
                <div class="weui-navbar__item" href="#tab2">已完成</div>
            </div>
            <div class="weui-tab__panel">
                <div class="weui-cells"  id="tab1"></div>
                <div class="weui-cells active"  id="tab2"></div>
            </div>
            <!--<div class="weui-loadmore">-->
                <!--<i class="weui-loading"></i>-->
                <!--<span class="weui-loadmore__tips">正在加载</span>-->
            <!--</div>-->
            <!--<div class="weui-loadmore weui-loadmore_line">-->
                <!--<span class="weui-loadmore__tips">暂无数据</span>-->
            <!--</div>-->
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        $('.weui-navbar__item').on('click', function () {
            $(this).addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
        });
        $(".weui-navbar div").click(function() {
            $(".weui-cells").hide();
            var activeTab = $(this).attr("href");
            $(activeTab).fadeIn();
            return false;
        });
        $('.weui-cell').on('click', function(){
            var id = $(this).data('id');
            window.pageManager.go(id);
        });
        $.ajax({
            type: "POST",
            url: "api/task.json",
            async: true,
            data:{userid:$('#userid').val()},
            success: function (data) {
                lists(data);
            },
            error: function (mes) {
                console.log('error');
            }
        });
////页面自动加载列表
//        var gPageSize = 10;
//        var i = 1;
//        function getData(pagenumber) {
//            i++; //页码自动增加，保证下次调用时为新的一页。
//            $.get("api/task.json", { pagesize: gPageSize, pagenumber: pagenumber }, function (data) {
//                if (data.length > 0) {
//                    var jsonObj = JSON.parse(data);
//                    insertDiv(jsonObj);
//                }
//            });
//            $.ajax({
//                type: "POST",
//                url: "api/task.json",
//                data: { pagesize: gPageSize, pagenumber: pagenumber },
//                dataType: "json",
//                success: function (data) {
//                    $(".weui-loadmore").hide();
//                    if (data.length > 0) {
//                        var jsonObj = JSON.parse(data);
//                        insertDiv(jsonObj);
//                    }
//                },
//                beforeSend: function () {
//                    $(".weui-loadmore").show();
//                },
//                error: function () {
//                    $(".weui-loadmore").hide();
//                }
//            });
//        }
//        //初始化加载第一页数据
//        getData(1);
//        //生成数据append到div中
//        function insertDiv(json) {
//            for (var i = 0; i <= json.length; i++) {
//                function getLocalTime(nS) {
//                    return new Date(parseInt(nS) * 1000).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ");
//                }
//                $('#tab1').append(
//                        '<div class="weui-cell bg-cell">' +
//                            '<div class="weui-cell__bd cell_bd_border" data-id="Unfinished_detail" >' +
//                                '<p class="left-cell">' +
//                                    json[i].hotelName +
//                                '</p>' +
//                                '<div class="weui-cell__ft cell_fs left-cell">' +
//                                    getLocalTime(json[i].createTime) +
//                                '</div>' +
//                            '</div>' +
//                        '</div>'
//                )
//            }
//            //到达底部加载
//            var winH = $(window).height(); //页面可视区域高度
//            var scrollHandler = function () {
//                var pageH = $(document.body).height();
//                var scrollT = $(window).scrollTop();
//                var aa = (pageH - winH - scrollT) / winH;
//                if (aa < 0.02) {
//                    getData(i);
//                    if (i % 10 === 0) {
//                        $(window).scroll(scrollHandler);
//                    }
//                }
//            }
//            //定义鼠标滚动事件
//            $(window).scroll(scrollHandler);
//        }
        function lists(data) {
            for(var i=0;i<=data.length;i++) {
                function getLocalTime(nS) {
                    return new Date(parseInt(nS)).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ");
                }
                $('#tab1').append(
                        '<div class="weui-cell bg-cell"  data-id="Unfinished_detail" data-tid="'+data[i].id+'">' +
                            '<div class="weui-cell__bd cell_bd_border" >' +
                                '<p class="left-cell">' +
                                    data[i].hotelName +
                                '</p>' +
                                '<div class="weui-cell__ft cell_fs left-cell">' +
                                    getLocalTime(data[i].createTime) +
                                '</div>' +
                            '</div>' +
                        '</div>'
                )
                $('#tab2').append(
                        '<div class="weui-cell bg-cell"  data-id="Finished_detail">' +
                            '<div class="weui-cell__bd cell_bd_border">' +
                                '<p class="left-cell">' +
                                    data[i].hotelName +
                                '</p>' +
                                '<div class="weui-cell__ft cell_fs left-cell">' +
                                    getLocalTime(data[i].createTime) +
                                '</div>' +
                            '</div>' +
                        '</div>'
                )
                $('.weui-cell').bind('click', function () {
                        var id = $(this).data('id');
                    $('#container').data('task-id',$(this).data('tid'));
                        window.pageManager.go(id);
//                        $(this).appendTo("#tab2")
                });
            }
        }
    });

</script>



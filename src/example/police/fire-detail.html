<div class="page">
    <div class="fire-nochecked" id="fire-nochecked">
        <div class="nochecked-header" id="name"></div>
    </div>
    <div class="detail-y">
        <div class="fire-nocheck-title">检查现场</div>
        <div class="none-flex cell-border cell-margin" id="site">
            <div class="weui-cell__bd bd-right" >
                <ul class="img-detail" id="site-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">法律文书</div>
        <div class="none-flex cell-border cell-margin" id="book">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="all-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">消防负责人</div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="person-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">企业地址</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="place"></div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">检查时间</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="time"></div>
        </div>
        <div class="hight-border"></div>
        <div class="height-fixed"></div>
    </div>
    <div class="weui-gallery" style="position: absolute;left: 0;"  id="gallery">
        <!--<img class="weui-gallery__img center-img" id="galleryImg"/>-->
    </div>
    <div class="lt-style">&lt;</div>
    <div class="gt-style">&gt;</div>
</div>
<script>
    $(function () {
        var container = $('#container');
        var id = container.data('fire-check-id');
        var cid =  container.data('data-company-name-cid');
        var widths = $(document).width();
        var $gallery = $("#gallery"),
             $galleryImg = $("#galleryImg");
        $.ajax({
            type: "POST",
            url: "api/company/detail.json",
            data:{userid:$('#userid').val(),id:cid},
            success: function (data) {
                $('#fire-nochecked').html(
                        '<div class="nochecked-header done-detail-head" id="name"></div>'+
                        '<marquee class="nochecked-header" id="name-scroll"></marquee>'
                );
                if(data.company.name.length>15){
                    $('#name-scroll').html(data.company.name);
                    $('#name').hide();
                }else{
                    $('#name').html(data.company.name);
                    $('#name-scroll').hide();
                }
            }
        });
        function inPop(callback){
            pageManager.setBeforeHashchangeOnce(function (e) {
                callback();
                return false;
            })
        }

        function outPop(){
            pageManager.setBeforeHashchangeOnce(null)
        }
        $.ajax({
            type: "POST",
            url: "api/fireCheck/detail.json",
            data:{userid:$('#userid').val(),id:id},
            success: function (data) {
                var j = 0;
                var n = 0;
                var m = 0;
                for(var i = 0;i<data.items.length;i++){
                    if(data.items[i].type=='check'){
                        j++;
                        $('#site-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list" data-index="'+j+'" data-item-type="'+0+'"/></li>');
                    }else if(data.items[i].type=='legal'){
                        n++;
                        $('#all-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list" data-index="'+n+'"  data-item-type="'+1+'"/></li>');
                    }else{
                        m++;
                        $('#person-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list" data-index="'+m+'" data-item-type="'+2+'"/></li>');
                    }
                    $('#place').html(data.company.address);
                    $('#time').html(getLocalTime(data.createTime));
                }
                $('.fire-img-list').on("click", function(){
                    $('#more-nums').remove();
                    $('#pack-up-book').remove();
                    inPop(function(){
                        $gallery.fadeOut(100);
                    });
                    var dataItemType=$(this).data('item-type');
                    if(dataItemType=='0'){
                        var j = $(this).data('index');
                        var indexLeft = (j-1)*widths+12*(j-1);
                        $gallery.css('left','-'+indexLeft+'px');
                        var index = $('#site-img li').length;
                        container.data('length',index);
                        var gWidth = index*widths+index*12;
                        $gallery.css('width',gWidth+'px');
                        var images = [];
                        $('#site-img li').each (function(){
                            var src = $(this).find('img').attr('src');
                            images.push(src);
                        });
                        $gallery.html('');
                        for(var i = 0;i<$('#site-img li').length;i++){
                            $gallery.append('<img class="img-wheel" style="float: left;width: '+widths+'px;padding:0 12px 0 0;" src="'+images[i]+'"/>');
                        };
                    }else if(dataItemType=='1'){
                        var n = $(this).data('index');
                        var indexLeft = (n-1)*widths+12*(n-1);
                        $gallery.css('left','-'+indexLeft+'px');
                        var index = $('#all-img li').length;
                        container.data('length',index);
                        var gWidth = index*widths+index*12;
                        $gallery.css('width',gWidth+'px');
                        var images = [];
                        $('#all-img li').each (function(){
                            var src = $(this).find('img').attr('src');
                            images.push(src);
                        });
                        $gallery.html('');
                        for(var i = 0;i<$('#all-img li').length;i++){
                            $gallery.append('<img class="img-wheel" style="float: left;width: '+widths+'px;padding:0 12px 0 0;" src="'+images[i]+'"/>');
                        };
                    }else if(dataItemType=='2'){
                        var m = $(this).data('index');
                        var indexLeft = (m-1)*widths+12*(m-1);
                        $gallery.css('left','-'+indexLeft+'px');
                        var index = $('#person-img li').length;
                        container.data('length',index);
                        var gWidth = index*widths+index*12;
                        $gallery.css('width',gWidth+'px');
                        var images = [];
                        $('#person-img li').each (function(){
                            var src = $(this).find('img').attr('src');
                            images.push(src);
                        });
                        $gallery.html('');
                        for(var i = 0;i<$('#person-img li').length;i++){
                            $gallery.append('<img class="img-wheel" style="float: left;width: '+widths+'px;padding:0 12px 0 0;" src="'+images[i]+'"/>');
                        };
                    }
//                    $galleryImg.attr("src", this.getAttribute("src"));
                    $gallery.show();
                });
                function swipeLeft(){
                    var index = container.data('length');
                    var leftWidth = (index-1)*widths+(index-1)*12;
                    if(parseInt($gallery.css('left'))!='-'+leftWidth){
                        var newLeft = parseInt($gallery.css('left')) - widths-12+'px';
                        $gallery.animate({left:newLeft},200,'linear');
                    }
                };
                function swipeRight(){
                    var newRight=0;
                    if(parseInt($gallery.css('left'))!=0){
                        newRight = parseInt($gallery.css('left')) + widths+12+'px';
                        $gallery.animate({left:newRight},200,'linear');
                    }
                }
                $gallery.on('swipeLeft',function(e){
                    swipeLeft();
                }).on('swipeRight',function(e){
                    swipeRight();
                }).on("click", function(){
                    outPop();
                    more();
                    $('.img-box-height').css('height','92px');
                    $('.img-book-height').css('height','92px');
                    $gallery.fadeOut(100);
                    $('.lt-style,.gt-style').hide();
                }).on(' mouseenter',function () {
                    $('.lt-style,.gt-style').show();
                });
                $('.lt-style').on('click',function(){
                    swipeRight();
                });
                $('.gt-style').on('click',function(){
                    swipeLeft();
                });
                more();
                function more() {
                    var width = $('.bd-right').width();
                    var nums = Math.floor(width/49)*2;
                    var length = $('#site-img li').length;
                    var more = length-nums+1;
                    var bookLength = $('#all-img li').length;
                    var moreBook = bookLength-nums+1;
                    var height = $('#site').height();
                    var bookHeight = $('#book').height();
                    if(height>92){
                        $('#site').addClass('img-box-height');
                    }else{
                        $('#site').removeClass('img-box-height');
                    }
                    if(bookHeight>92){
                        $('#book').addClass('img-book-height');
                    }else{
                        $('#book').removeClass('img-book-height');
                    }
                    $('#site-img li').eq(nums-2).after('<li class="more-img" id="more-num">+'+more+'</li>');
                    $('#site-img li').eq(length).after('<li class="more-img pack-up" id="pack-up">收起</li>');
                    if(more<=1){
                        $('#more-num').hide();
                        $('#pack-up').hide();
                    }
                    $('#more-num').on('click',function(){
                        $('.img-box-height').css('height','auto');
                        $(this).hide();
                    });
                    $('#pack-up').on('click',function(){
                        $('.img-box-height').css('height','92px');
                        $('#more-num').show();
                    });
                    $('#all-img li').eq(nums-2).after('<li class="more-img" id="more-nums">+'+moreBook+'</li>');
                    $('#all-img li').eq(bookLength).after('<li class="more-img pack-up" id="pack-up-book">收起</li>');
                    if(moreBook<=1){
                        $('#more-nums').hide();
                        $('#pack-up-book').hide();
                    }
                    $('#more-nums').on('click',function(){
                        $('.img-book-height').css('height','auto');
                        $(this).hide();
                    });
                    $('#pack-up-book').on('click',function(){
                        $('.img-book-height').css('height','92px');
                        $('#more-nums').show();
                    });
                };
            },
            error: function (mes) {
                console.log("error");
            }
        })

    })
</script>
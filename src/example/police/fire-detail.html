<div class="page">
    <div class="fire-nochecked" id="fire-nochecked">
        <div class="nochecked-header" id="name"></div>
    </div>
    <div class="detail-y">
        <div class="fire-nocheck-title">检查现场</div>
        <div class="none-flex cell-border cell-margin" id="site">
            <div class="weui-cell__bd bd-right" >
                <ul class="img-detail" id="site-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">法律文书</div>
        <div class="none-flex cell-border cell-margin" id="book">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="all-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">消防负责人</div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="person-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">企业地址</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="place"></div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">检查时间</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="time"></div>
        </div>
        <div class="hight-border"></div>
        <div class="height-fixed"></div>
    </div>
    <div class="weui-gallery" id="gallery">
        <img class="weui-gallery__img center-img" id="galleryImg"/>
    </div>
</div>
<script>
    $(function () {
        var container = $('#container');
        var id = container.data('fire-check-id');
        var cid =  container.data('data-company-name-cid');
        var $gallery = $("#gallery"),
             $galleryImg = $("#galleryImg");
        $.ajax({
            type: "POST",
            url: "api/company/detail.json",
            data:{userid:$('#userid').val(),id:cid},
            success: function (data) {
                $('#fire-nochecked').html(
                        '<div class="nochecked-header done-detail-head" id="name"></div>'+
                        '<marquee class="nochecked-header" id="name-scroll"></marquee>'
                );
                if(data.company.name.length>15){
                    $('#name-scroll').html(data.company.name);
                    $('#name').hide();
                }else{
                    $('#name').html(data.company.name);
                    $('#name-scroll').hide();
                }
            }
        });
        function inPop(callback){
            pageManager.setBeforeHashchangeOnce(function (e) {
                callback();
                return false;
            })
        }

        function outPop(){
            pageManager.setBeforeHashchangeOnce(null)
        }
        $.ajax({
            type: "POST",
            url: "api/fireCheck/detail.json",
            data:{userid:$('#userid').val(),id:id},
            success: function (data) {
                for(var i = 0;i<data.items.length;i++){
                    if(data.items[i].type=='check'){
                        $('#site-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list"/></li>')
                    }else if(data.items[i].type=='legal'){
                        $('#all-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list"/></li>')
                    }else{
                        $('#person-img').append('<li><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list"/></li>')
                    }
                    $('#place').html(data.company.address);
                    $('#time').html(getLocalTime(data.createTime));
                }
                $('.fire-img-list').on("click", function(){
                    inPop(function(){
                        $gallery.fadeOut(100);
                    });
                    $galleryImg.attr("src", this.getAttribute("src"));
                    $gallery.fadeIn(100);
                });
                $gallery.on("click", function(){
                    outPop();
                    $gallery.fadeOut(100);
                });
                var width = $('.bd-right').width();
                var nums = Math.floor(width/49)*2;
                var length = $('#site-img li').length;
                var more = length-nums+1;
                var bookLength = $('#all-img li').length;
                var moreBook = bookLength-nums+1;
                var height = $('#site').height();
                var bookHeight = $('#book').height();
                if(height>92){
                    $('#site').addClass('img-box-height');
                }else{
                    $('#site').removeClass('img-box-height');
                }
                if(bookHeight>92){
                    $('#book').addClass('img-book-height');
                }else{
                    $('#book').removeClass('img-book-height');
                }
                $('#site-img li').eq(nums-2).after('<li class="more-img" id="more-num">+'+more+'</li>');
                $('#site-img li').eq(length).after('<li class="more-img pack-up" id="pack-up">收起</li>');
                if(more<=1){
                    $('#more-num').hide();
                    $('#pack-up').hide();
                }
                $('#more-num').on('click',function(){
                    $('.img-box-height').css('height','auto');
                    $(this).hide();
                });
                $('#pack-up').on('click',function(){
                    $('.img-box-height').css('height','92px');
                    $('#more-num').show();
                });
                $('#all-img li').eq(nums-2).after('<li class="more-img" id="more-nums">+'+moreBook+'</li>');
                $('#all-img li').eq(bookLength).after('<li class="more-img pack-up" id="pack-up-book">收起</li>');
                if(moreBook<=1){
                    $('#more-nums').hide();
                    $('#pack-up-book').hide();
                }
                $('#more-nums').on('click',function(){
                    $('.img-book-height').css('height','auto');
                    $(this).hide();
                });
                $('#pack-up-book').on('click',function(){
                    $('.img-book-height').css('height','92px');
                    $('#more-nums').show();
                });

            },
            error: function (mes) {
                console.log("error");
            }
        })

    })
</script>
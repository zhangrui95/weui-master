<div>
    <div class="page-alert" id="alertbackground">
        <div class="weui-search-bar" id="searchBar">
            <form class="weui-search-bar__form">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required="">
                    <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
                </div>
                <label class="weui-search-bar__label" id="searchText">
                    <i class="weui-icon-search"></i>
                    <span>搜索</span>
                </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
        </div>
        <div class="weui-cells  weui-cells_radio hotel-list" id="hotel-list">
            <div id="box"></div>
        </div>
        <div class="btn-box" data-id="employee_list" id="look">
            <a class="btn" href="javascript:" id="showToast" data-id="renter-news">确定</a>
        </div>
    </div>
</div>
<script>
    $(function () {
        var container = $('#container');
        var pagePanel = $('#hotel-list');
        var $searchBar = $('#searchBar'),
                $searchResult = $('#searchResult'),
                $searchText = $('#searchText'),
                $searchInput = $('#searchInput'),
                $searchClear = $('#searchClear'),
                $searchCancel = $('#searchCancel');
        function hideSearchResult(){
            $searchResult.hide();
            $searchInput.val('');
        }
        function cancelSearch(){
            hideSearchResult();
            $searchBar.removeClass('weui-search-bar_focusing');
            $searchText.show();
        }

        $searchText.on('click', function(){
            $searchBar.addClass('weui-search-bar_focusing');
            $searchInput.focus();
        });
        $searchClear.on('click', function(){
            hideSearchResult();
            $searchInput.focus();
            $('#list').show();
        });
        $searchCancel.on('click', function(){
            cancelSearch();
            $searchInput.blur();
        });
        var currDataListCfg = {
            url:'api/floor/list.json',
            pagePanel:pagePanel,
            scrollPanel:pagePanel.find('#box'),
            winPanel:container,
            xhrListKey:'',
            itemsPanel:$('#box'),
            xhrExternalProcess : function (params) {
                $('#'+container.data('data-floorid')).attr('checked','true');
            },
            emptyCb : function () {
                $('#hotel-list').html('<div class="empty-box">'+
                        '<img src="images/icon-over.jpg" class="empty-img"/>'+
                        '<p class="null-word">暂无数据</p>'+
                        '</div>');
            },
            noMoreCb : function () {
                $('.weui-loadmore_line').show();
                $('.empty-box').hide();
            },
            templateProcess : function (items) {
                var ridg = items.ridgepole+'栋'
                var units = items.unit+'单元'
                if(items.ridgepole==null||items.ridgepole.length==0){
                    ridg = '';
                }
                if(items.unit==null||items.unit.length==0){
                    units = '';
                }
                var place = items.street+items.num+'号'+ridg+units+items.door+'门'
                return '<label class="weui-cell weui-check__label check-border-list hotel-list-height" for="'+items.id+'">'+
                        '<div class="weui-cell__ft ft_width">'+
                        '<div class="border-gray"></div>'+
                        '<input type="radio" name="radio1" class="weui-check" id="'+items.id+'">'+
                        '<span class="weui-icon-checked"></span>'+
                        '</div>'+
                        '<div class="hotel-news">'+
                        '<div class="hotel-name">'+place+'</div>'+
                        '</div>'+
                        '</label>';
            },
            before:function(){
                $("#load").show();
                $(".weui-loadmore_line").hide();
            },
            after:function(){
                $("#load").hide();
            }
        };
        var typeIds = '';
        var policeId = container.data('self-policeId');
        var currDataList = window.dataList.newList(currDataListCfg);
        var val = container.data('data-list-val');
        currDataList.first({typeIds:typeIds,policeId:policeId,name:val});
        var search = function(){
            var val=$searchInput.val();
            container.data('data-list-val',val);
            if(val != ""){
                currDataList.first({typeIds:typeIds,policeId:policeId,name:val});
            }
        };
        $searchInput.on('keyup',function(){
            window.lazyRateProxy(search,500);
        });
        var reset = function () {
            val='';
            container.data('data-list-val',val);
            currDataList.first({typeIds:typeIds,policeId:policeId,name:val});
        };
        $searchCancel.on('click',function(){
            reset();
        });
        $searchInput
                .on('blur', function () {
                    if(!this.value.length) {
                        cancelSearch();
                    }
                    if(this.value.length==0){
                        reset();
                    }
                })
                .on('input', function(){
                    if(this.value.length) {
                        $searchResult.show();
                    } else {
                        $searchResult.hide();
                    }
                })
        ;
        if(val!=null){
            $searchBar.addClass('weui-search-bar_focusing');
            $searchInput.val(val);
        }
        $('#showToast').on('click',function () {
            var floorId;
            var place;
            $('.weui-check').each(function(i,e){
                var oThis = $(e);
                if(oThis.prop('checked')){
                    floorId = oThis.attr('id');
                    place = oThis.parent().siblings().find('.hotel-name').html();
                }
            });
            container.data('data-floorid',floorId)
            container.data('data-floor-place',place)
            var id = $(this).data('id');
            window.pageManager.go(id);
        });
    })
</script>
<!--旅店信息-->
<div class="page page-list">
    <div class="search-results result-name-size" id="name"></div>
    <div class="page__bd cell-y bg-page bottom-cell">
        <div id="box" class="bg-box">
            <div class="weui-tab__panel panel_none" id="employee-list"></div>
            <div class="weui-loadmore" id="load">
                <i class="weui-loading"></i>
                <span class="weui-loadmore__tips">正在加载</span>
            </div>
            <div class="weui-loadmore weui-loadmore_line active">
                <span class="weui-loadmore__tips">暂无更多数据</span>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var gPageSize = 10;
        var offset = 0;
        var currState = '0';
        var loading = false;
        function getData(state) {
            if(loading){
                return;
            }
            loading = true;
            $.ajax({
                type: "POST",
                url: "api/employee/listByCompany.json",
                async: true,
                data: {userid: $('#userid').val(), max: gPageSize, offset: offset},
                success: function (data) {
                    lists(data,state);
                    $('#name').html(
                            '<span class="result-name">'+data.company.name+'</span>'+
                            '<span class="result-num">(<span class="type-red">'+data.undo+'</span>/<span class="type-blue">'+data.done+'</span>)</span>'
                    )
                    $(".weui-cell").on('click',function () {
                        var id = $(this).data('id');
                        $('#container').data('detail-source','company-list');
                        $('#taskId').val($(this).data('tid'));
                        window.pageManager.go(id);
                    });
                    $("#load").hide();
                    loading = false;
                    if(offset==0){
                        $('.weui-loadmore_line').hide();
                    }else{
                        if(data==null||data.length<1){
                            $('.weui-loadmore_line').show();
                            $('.empty-box').hide();
                        }
                    }

                },
                beforeSend: function () {
                    $("#load").show();
                    $(".weui-loadmore_line").hide();
                },
                error: function () {
                    $("#load").hide();
                    loading = false;
                }
            });
        }
        function lists(data,state) {
            var dataId = 'employee_detail';
            for(var i=0;i<data.list.length;i++) {
                var items=data.list[i];
                if(items.state == '0') {
                    $('#employee-list').append(
                            '<div class="weui-cell bg-cell no-margin"  data-id="'+dataId+'" data-tid="'+items.id+'">' +
                            '<div class="weui-cell__bd cell_bd_border" >' +
                            '<span  class="red-circle"></span>'+
                            '<p class="left-cell">' +
                            items.card +
                            '</p>' +
                            '<div class="weui-cell__ft cell_fs left-cell">' +
                            '<img src="images/icon-time.jpg" class="position-time"/>'+
                            '<span>'+getLocalTime(items.createTime)+'</span>'  +
                            '<img class="icon-go" src="images/icon-go.jpg"/>'+
                            '</div>' +
                            '</div>' +
                            '</div>'
                    );
                }else{
                    $('#employee-list').append(
                            '<div class="weui-cell bg-cell no-margin"  data-id="'+dataId+'" data-tid="'+items.id+'">' +
                            '<div class="weui-cell__bd cell_bd_border" >' +
                            '<span></span>'+
                            '<p class="left-cell">' +
                            items.card +
                            '</p>' +
                            '<div class="weui-cell__ft cell_fs left-cell">' +
                            '<img src="images/icon-time.jpg" class="position-time"/>'+
                            '<span>'+getLocalTime(items.createTime)+'</span>'  +
                            '<img class="icon-go" src="images/icon-go.jpg"/>'+
                            '</div>' +
                            '</div>' +
                            '</div>'
                    );
                }

            }
        }

        getData(currState);

        var pagePanel = $('#container .page .page__bd');
        //到达底部加载
        var winH = $('#container').height(); //页面可视区域高度
        var scrollHandler = function () {
            var pageH = pagePanel.find('#box').height();
            var scrollT = pagePanel.scrollTop();
            var aa = (pageH - winH - scrollT) / winH;
            if (aa < 0.02) {
                getData(currState);
            }
        };
//        定义鼠标滚动事件
        pagePanel.on('scroll',scrollHandler);

    });

</script>



<div class="page page-list">
    <div class="page__bd">
        <div class="weui-cells  weui-cells_radio police_list"></div>
        <div class="weui-loadmore">
            <i class="weui-loading"></i>
            <span class="weui-loadmore__tips">正在加载</span>
        </div>
    </div>
    <div class="weui-btn-area" data-id="hotel_news">
        <a class="weui-btn weui-btn_primary" href="javascript:" id="showToast" >确定</a>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var gPageSize = 10;
        var offset = 0;
        var currState = '0';
        var loading = false;
        function getData() {
            if (loading) {
                return;
            }
            loading = true;
            $.ajax({
                type: "POST",
                url: "api/user/role.json",
                data: {userid: $('#userid').val(), max: gPageSize, offset: offset,role:'4'},
                success: function (data) {
                    for(j=0;j<data.length;j++){
                        if(data[j].avatar==null||data[j].avatar==''){
                            data[j].avatar = 'images/head.jpg'
                        }
                    }

                    lists(data);
                    $(".weui-loadmore").hide();
                    loading = false;
                },
                beforeSend: function () {
                    $(".weui-loadmore").show();
                },
                error: function (mes) {
                    $(".weui-loadmore").hide();
                    loading = false;
                }
            });
        }
        function lists(data) {
            if(data==null||data.length<1){
                return
            }
            offset += data.length;
            for(var i=0;i<data.length;i++){
                console.log(data[i].avatar)
                    $('.police_list').append(
                            '<label class="weui-cell weui-check__label cells-border" for='+i+' data-rota="'+data[i].id+'">'+
                                '<div class="weui-cell__ft ft_width">'+
                                    '<div class="border-gray"></div>'+
                                    '<input type="radio" name="radio1" class="weui-check" id='+i+' >'+
                                    '<span class="weui-icon-checked"></span>'+
                                '</div>'+
                                '<div><img src="'+data[i].avatar+'" class="header-img"/></div>'+
                                '<div class="weui-cell__bd">'+
                                    '<p>'+data[i].name+'</p>'+
                                '</div>'+
                            '</label>'
                    )
            }
        }
        getData(currState);

        var pagePanel = $('#container .page-list');
        //到达底部加载
        var winH = $('#container').height(); //页面可视区域高度
        var scrollHandler = function () {
            var pageH = pagePanel.find('.page__bd').height();
            var scrollT = pagePanel.scrollTop();
            var aa = (pageH - winH - scrollT) / winH;
            if (aa < 0.02) {
                getData(currState);
            }
        };
        //定义鼠标滚动事件
        pagePanel.on('scroll',scrollHandler);
        $("#showToast").click(function(){
            $.ajax({
                type: "POST",
                url: "api/rota/allot.json",
                data:{uid:$('#userid').val(),id:$('label').data('rota')},
                success: function () {
                      history.back();
                },
                error: function (mes) {
                }
            });
        })
    })
</script>
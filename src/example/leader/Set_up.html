<div class="page page-list">
    <div class="page__bd page_y">
        <ul class="search-list">
            <li>A</li>
            <li>B</li>
            <li>C</li>
            <li>D</li>
            <li>E</li>
            <li>F</li>
            <li>G</li>
            <li>H</li>
            <li>I</li>
            <li>J</li>
            <li>K</li>
            <li>L</li>
            <li>M</li>
            <li>N</li>
            <li>O</li>
            <li>P</li>
            <li>Q</li>
            <li>R</li>
            <li>S</li>
            <li>T</li>
            <li>U</li>
            <li>V</li>
            <li>W</li>
            <li>X</li>
            <li>Y</li>
            <li>Z</li>
        </ul>
        <div class="weui-cells  weui-cells_radio police_list"></div>
        <div class="weui-loadmore">
            <i class="weui-loading"></i>
            <span class="weui-loadmore__tips">正在加载</span>
        </div>
    </div>
    <div class="btn-box" data-id="hotel_news">
        <a class="btn" href="javascript:" id="showToast" data-id="leader_news">确定</a>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var gPageSize = 10;
        var offset = 0;
        var currState = '0';
        var loading = false;
        function getData() {
            if (loading) {
                return;
            }
            loading = true;
            $.ajax({
                type: "POST",
                url: "api/user/role.json",
                data: {userid: $('#userid').val(), max: gPageSize, offset: offset,role:'4'},
                success: function (data) {
                    for(var j=0;j<data.length;j++){
                        if(data[j].avatar==null||data[j].avatar==''){
                            data[j].avatar = 'images/head.jpg'
                        }else{
                            data[j].avatar += '64'
                        }
                    }

                    lists(data);
                    $(".weui-loadmore").hide();
                    loading = false;
                },
                beforeSend: function () {
                    $(".weui-loadmore").show();
                },
                error: function (mes) {
                    $(".weui-loadmore").hide();
                    loading = false;
                }
            });
        }
        function lists(data) {
            if(data==null||data.length<1){
                return
            }
            offset += data.length;
            var html = '',item,curr = $('#container').data('today-rota-id');
            for(var i=0;i<data.length;i++){
                item = data[i];
                html += '<label class="weui-cell weui-check__label cells-border" for='+i+'>'+
                                '<div class="weui-cell__ft ft_width">'+
                                    '<div class="border-gray"></div>'+
                                    '<input type="radio" name="radio1" class="weui-check" '+(curr==item.id?'checked="checked"':'')+' id='+i+' data-rota="'+item.id+'">'+
                                    '<span class="weui-icon-checked"></span>'+
                                '</div>'+
                                '<div><img src="'+item.avatar+'" class="header-img"/></div>'+
                                '<div class="weui-cell__bd">'+
                                    '<p>'+item.name+'</p>'+
                                '</div>'+
                            '</label>';
            }
            $('.police_list').append(html);
        }
        getData(currState);

        var pagePanel = $('#container .page-list');
        //到达底部加载
        var winH = $('#container').height(); //页面可视区域高度
        var scrollHandler = function () {
            var pageH = pagePanel.find('.page__bd').height();
            var scrollT = pagePanel.scrollTop();
            var aa = (pageH - winH - scrollT) / winH;
            if (aa < 0.02) {
                getData(currState);
            }
        };
        //定义鼠标滚动事件
        $("#showToast").click(function(){
            var rota;
            $('.weui-check').each(function(i,e){
                var oThis = $(e);
                if(oThis.prop('checked')){
                    rota = oThis.data('rota')
                }

            })
            var id = $("#showToast").data('id');
            var curr = $('#container').data('today-rota-id');
            if(rota==null||rota==''|| rota==curr){
                window.pageManager.go(id);
                return;
            }
            $.ajax({
                type: "POST",
                url: "api/rota/allot.json",
                data:{userid:$('#userid').val(),uid:rota},
                success: function () {
                        window.pageManager.go(id);
                },
                error: function (mes) {
                }
            });

        })
    })
</script>
<div class="page">
    <div class="fire-nochecked" id="fire-nochecked"></div>
    <div class="detail-y">
        <div class="fire-nocheck-title">检查现场</div>
        <div class="none-flex cell-border cell-margin" id="site">
            <div class="weui-cell__bd bd-right" >
                <ul class="img-detail" id="site-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">法律文书</div>
        <div class="none-flex cell-border cell-margin" id="book">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="all-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="fire-nocheck-title">消防负责人</div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__bd bd-right">
                <ul class="img-detail" id="person-img"></ul>
            </div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">企业地址</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="place"></div>
        </div>
        <div class="hight-border"></div>
        <div class="none-flex cell-border cell-margin">
            <div class="weui-cell__hd"><label class="weui-label">检查时间</label></div>
            <div class="weui-cell__bd bd-right place-top"  id="time"></div>
        </div>
        <div class="hight-border"></div>
        <div class="height-fixed"></div>
    </div>
</div>
<script>
    $(function () {
        var container = $('#container');
        var id = container.data('fire-check-id');
        var cid =  container.data('data-company-name-cid');
        var $gallery = $("#gallery");
        var $gallery2 = $("#gallery2");
        var $gallery3 = $("#gallery3");
        function inPop(callback){
            pageManager.setBeforeHashchangeOnce(function (e) {
                callback();
                return false;
            })
        }

        function outPop(){
            pageManager.setBeforeHashchangeOnce(null)
        }

        $.ajax({
            type: "POST",
            url: "api/company/detail.json",
            data:{userid:$('#userid').val(),id:cid},
            success: function (data) {
                $('#fire-nochecked').html(
                        '<div class="nochecked-header done-detail-head" id="name"></div>'+
                        '<marquee class="nochecked-header" id="name-scroll"></marquee>'
                );
                if(data.company.name.length>15){
                    $('#name-scroll').html(data.company.name);
                    $('#name').hide();
                }else{
                    $('#name').html(data.company.name);
                    $('#name-scroll').hide();
                }
            }
        });
        load();
        function load(){
            $('.img-detail').html('');
            $.ajax({
                type: "POST",
                url: "api/fireCheck/detail.json",
                data:{userid:$('#userid').val(),id:id},
                success: function (data) {
                    var j = 0;
                    var n = 0;
                    var m = 0;
                    for(var i = 0;i<data.items.length;i++){
                        if(data.items[i].type=='check'){
                            j++;
                            $('#site-img').append('<li class="index-fire"><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list" data-index="'+j+'" data-item-type="'+0+'"/></li>');
                        }else if(data.items[i].type=='legal'){
                            n++;
                            $('#all-img').append('<li class="index-fire"><img src="api/fireCheck/photo?id='+data.items[i].id+'" class="fire-img-list" data-index="'+n+'"  data-item-type="'+1+'"/></li>');
                        }else{
                            m++;
                            $('#person-img').append('<li class="index-fire"><img src="api/fireCheck/photo?id='+data.items[i].id+'" data-index="'+m+'" class="fire-img-list" data-item-type="'+2+'"/></li>');
                        }
                        $('#place').html(data.company.address);
                        $('#time').html(getLocalTime(data.createTime));
                    }
                    imgClick("#site-img .index-fire img");
                    imgClick("#all-img .index-fire img");
                    imgClick("#person-img .index-fire img");
                    more();
                },
                error: function (mes) {
                    console.log("error");
                }
            });
        };
       function more() {
           var width = $(window).width()-40;
           var nums = Math.floor(width / 49) * 2;
           var length = $('#site-img li').length;
           var more = length - nums + 1;
           var bookLength = $('#all-img li').length;
           var moreBook = bookLength - nums + 1;
           var height = 47*Math.ceil(length/Math.floor(width / 49))+14;
           var bookHeight = 47*Math.ceil(bookLength/Math.floor(width / 49))+14;
           if (height > 92) {
               $('#site').addClass('img-box-height');
           } else {
               $('#site').removeClass('img-box-height');
           }
           if (bookHeight > 92) {
               $('#book').addClass('img-book-height');
           } else {
               $('#book').removeClass('img-book-height');
           }
           $('#site-img li').eq(nums - 2).after('<li class="more-img" id="more-num">+' + more + '</li>');
           $('#site-img li').eq(length).after('<li class="more-img pack-up" id="pack-up">收起</li>');
           if (more <= 1) {
               $('#more-num').hide();
               $('#pack-up').hide();
           }
           $('#more-num').on('click', function () {
               $('.img-box-height').css('height', 'auto');
               $(this).hide();
           });
           $('#pack-up').on('click', function () {
               $('.img-box-height').css('height', '92px');
               $('#more-num').show();
           });
           $('#all-img li').eq(nums - 2).after('<li class="more-img" id="more-nums">+' + moreBook + '</li>');
           $('#all-img li').eq(bookLength).after('<li class="more-img pack-up" id="pack-up-book">收起</li>');
           if (moreBook <= 1) {
               $('#more-nums').hide();
               $('#pack-up-book').hide();
           }
           $('#more-nums').on('click', function () {
               $('.img-book-height').css('height', 'auto');
               $(this).hide();
           });
           $('#pack-up-book').on('click', function () {
               $('.img-book-height').css('height', '92px');
               $('#more-nums').show();
           });
       }
    })
</script>
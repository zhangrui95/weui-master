<div class="page">
    <div class="page__bd details cells-ajax"></div>
    <div class="weui-gallery" id="gallery">
        <img  class="weui-gallery__img center-img" id="galleryImg"/>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        $gallery = $("#gallery"),
        $galleryImg = $("#galleryImg")
        document.title = '详情';
        $.ajax({
            type: "POST",
            url: "api/task/leaderDetail.json",
            data:{id:$('#taskId').val(),userid:$('#userid').val()},
            success: function (data) {
                lists(data);
            },
            error: function (mes) {
                console.log("error");
            }
        });
        function lists(data) {
            var task = data.task;
            var rota = data.rota;
            if(rota != null && rota.length > 0){
                rota = rota[0].user.name;
            }
            var address = task.user.address;
            address = address==null?'':address;
            var company = task.user.company;
            company = company==null?'':company;
            var html ='<div class="weui-cells weui-cells_form cells-margin" id="'+task.id+'">' +
                        '<div class="weui-cell cell-top">'+
                            '<div class="weui-cell__bd bd-center cell-unleft">'+
                                '<img src="api/task/photo?id='+task.id+'&userid='+$('#userid').val()+'" alt="" class="head-img">'+
                           '</div>'+
                        '</div>'+
                        '<div class="weui-cell cell-border">'+
                            '<div class="weui-cell__hd"><label class="weui-label">身份证号</label></div>'+
                            '<div class="weui-cell__bd bd-right">'+
                                task.card+
                            '</div>'+
                        '</div>'+
                        '<div class="weui-cell cell-border cell-margin">'+
                            '<div class="weui-cell__hd"><label class="weui-label">入住宾馆</label></div>'+
                            '<div class="weui-cell__bd bd-right" >'+
                                company+
                            '</div>'+
                        '</div>'+
                        '<div class="weui-cell cell-border cell-margin">'+
                            '<div class="weui-cell__hd"><label class="weui-label">宾馆地址</label></div>'+
                            '<div class="weui-cell__bd bd-right" >'+
                                address+
                            '</div>'+
                        '</div>'+
                        '<div class="weui-cell cell-border cell-margin">'+
                            '<div class="weui-cell__hd"><label class="weui-label">上报电话</label></div>'+
                            '<div class="weui-cell__bd bd-right" >'+
                                task.user.mobile+
                            '</div>'+
                        '</div>'+
                        '<div class="weui-cell cell-border">'+
                            '<div class="weui-cell__hd"><label class="weui-label">上报时间</label></div>'+
                            '<div class="weui-cell__bd bd-right">'+
                                getLocalTime(task.createTime)+
                            '</div>'+
                        '</div>';
            if(task.state=='1'){
                html += '<div class="weui-cell cell-border">'+
                            '<div class="weui-cell__hd"><label class="weui-label">完成时间</label></div>'+
                            '<div class="weui-cell__bd bd-right">'+
                                getLocalTime(task.doneTime)+
                            '</div>'+
                        '</div>';
            }
            html +='<div class="weui-cell cell-border">'+
                        '<div class="weui-cell__hd"><label class="weui-label">值班民警</label></div>'+
                        '<div class="weui-cell__bd bd-right">'+
                            rota+
                        '</div>'+
                    '</div>';
//            if(task.state=='1'){
//                html += '<div class="weui-cell cell-border bottom-cell">'+
//                            '<div class="weui-cell__hd"><label class="weui-label">操作人员</label></div>'+
//                            '<div class="weui-cell__bd bd-right">'+
//                                task.doneUser.name+
//                            '</div>'+
//                        '</div>';
//            }
            html += '</div>';
            $('.cells-ajax').append(html);
            $('.head-img').on("click", function(){
                $galleryImg.attr("src", this.getAttribute("src"));
                $gallery.fadeIn(100);
            });
            $gallery.on("click", function(){
                $gallery.fadeOut(100);
            });
        }
    })
</script>

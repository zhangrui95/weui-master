<div class="page page-list">
    <img class="change-news" src="images/icon-edit.png" id="change"/>
    <div id="error" class="error" style="display: none;">
        <img src="images/error.png"/>
        <span>当前网络不可用，请检查你的网络设置</span>
    </div>
    <form class="active" id="form-box"></form>
    <div class="active" id="dele-new"></div>
    <div class="page__bd details cells-ajax page_y"></div>
    <div class="weui-gallery" id="gallery">
        <img  class="weui-gallery__img center-img" id="galleryImg"/>
    </div>
    <div class="btn-box" data-id="employee_list" id="look">
        <a class="btn" href="javascript:" id="showToast" data-id="police-company_list">查看从业人员列表</a>
    </div>
    <div>
        <div class="weui-mask" id="iosMask" style="display: none"></div>
        <div class="weui-actionsheet" id="iosActionsheet">
            <div class="weui-actionsheet__menu" id="choice-list"></div>
            <div class="weui-actionsheet__action">
                <div class="weui-actionsheet__cell" id="iosActionsheetCancel">取消</div>
            </div>
        </div>
    </div>
    <div>
        <div class="weui-mask" id="iosMasks" style="display: none"></div>
        <div class="weui-actionsheet" id="iosActionsheets">
            <div class="weui-actionsheet__menu weui-actionsheet__menu-height" id="choice-lists">
                <div class="weui-actionsheet__cell group-choice-name" data-group="0">普通</div>
                <div class="weui-actionsheet__cell group-choice-name" data-group="1">其他</div>
            </div>
            <div class="weui-actionsheet__action">
                <div class="weui-actionsheet__cell" id="iosActionsheetCancels">取消</div>
            </div>
        </div>
    </div>
    <div>
        <div class="weui-mask" id="iosMask-fire" style="display: none"></div>
        <div class="weui-actionsheet" id="iosActionsheet-fire">
            <div class="weui-actionsheet__menu weui-actionsheet__menu-height" id="choice-list-fire">
                <div class="weui-actionsheet__cell fire-choice-name" data-fire="0">非重点消防单位</div>
                <div class="weui-actionsheet__cell fire-choice-name" data-fire="1">重点消防单位</div>
            </div>
            <div class="weui-actionsheet__action">
                <div class="weui-actionsheet__cell" id="iosActionsheetCancel-fire">取消</div>
            </div>
    </div>
    <div class="weui-mask" id="iosMask-police" style="display: none"></div>
        <div class="weui-actionsheet" id="iosActionsheet-police">
            <div class="weui-actionsheet__menu" id="choice-list-police"></div>
            <div class="weui-actionsheet__action">
                <div class="weui-actionsheet__cell" id="iosActionsheetCancel-police">取消</div>
            </div>
        </div>
    </div>
    <div class="blank active" id="alert">
        <div class="td-style td-top">
            <div class="td-name">姓名</div>
            <input type='text' id="legal-person-name" placeholder="法人姓名"/>
        </div>
        <div class="td-style">
            <div class="td-name">手机号码</div>
            <input type='text' id="legal-phone"  placeholder="11位手机号码"/>
        </div>
        <div class="td-style">
            <div class="td-name">电话号码</div>
            <input type='text' id="legal-company-tel-num" placeholder="企业电话号码"/>
        </div>
        <div class="td-style">
            <div class="td-name">身份证号</div>
            <input type='text' id="IdCard" placeholder="法人身份证号码"/>
        </div>
        <div class="button-box" data-id="employee_list" >
            <a class="imported-left none-style" href="javascript:" id="dis-none2" data-id="police-company_list">取消</a>
            <a class="btn-bg bg-style" href="javascript:" id="new-save" data-id="police-company_list">确定</a>
        </div>
    </div>
    <div class="page-alert active" id="alertbackground"></div>
    <div class="blank active" id="alert-person">
        <div class="td-style td-top">
            <div class="td-name">姓名</div>
            <input type='text' id="linkName" placeholder="联系人姓名"/>
            <span class="star-red">*</span>
        </div>
        <div class="td-style">
            <div class="td-name">手机号码</div>
            <input type='text' id="linkPhone" placeholder="11位手机号码"/>
            <span class="star-red">*</span>
        </div>
        <div class="td-style" >
            <div class="td-name">微信号</div>
            <input type='text' id="WeXin" placeholder="微信账号"/>
        </div>
        <div class="td-style">
            <div class="td-name">邮箱</div>
            <input type='text' id="E-mail" placeholder="邮箱账号"/>
        </div>
        <div class="td-style" >
            <div class="td-name">职位</div>
            <input type='text'id="Work" placeholder="工作职位"/>
        </div>
        <div class="prompt active" id="prompt">*请输入必填项</div>
        <div class="button-box active" data-id="employee_list" id="person-news-change-btn">
            <a class="imported-left none-style" href="javascript:" id="dis-none" data-id="police-company_list">取消</a>
            <a class="btn-bg bg-style" href="javascript:" id="news-save" data-id="police-company_list">确定</a>
        </div>
        <div class="button-box active" data-id="employee_list" id="amend">
            <a class="imported-left none-style" href="javascript:" id="dis-none1" data-id="police-company_list">取消</a>
            <a class="btn-bg bg-style" href="javascript:" id="amend-new" data-id="police-company_list">修改</a>
        </div>
    </div>
    <div class="page-alert active" id="personbackground"></div>
    <div class="page-alert active" id="changeground"></div>
    <div class="js_dialog" id="androidDialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog weui-skin_android">
            <div class="weui-dialog__bd" id="dialog"></div>
            <div class="weui-dialog__ft" id="primary-box">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default" id="default">取消</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="primary">确定</a>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var $iosActionsheet = $('#iosActionsheet');
        var $iosMask = $('#iosMask');
        var $iosActionsheets = $('#iosActionsheets');
        var $iosMasks = $('#iosMasks');
        var $iosActionsheetFire = $('#iosActionsheet-fire');
        var $iosMaskFire = $('#iosMask-fire');
        var $iosActionsheetPolice = $('#iosActionsheet-police');
        var $iosMaskPolice = $('#iosMask-police');
        function hideActionSheet() {
            $iosActionsheet.removeClass('weui-actionsheet_toggle');
            $iosMask.fadeOut(200);
            $iosActionsheets.removeClass('weui-actionsheet_toggle');
            $iosMasks.fadeOut(200);
            $iosActionsheetPolice.removeClass('weui-actionsheet_toggle');
            $iosMaskPolice.fadeOut(200);
            $iosActionsheetFire.removeClass('weui-actionsheet_toggle');
            $iosMaskFire.fadeOut(200);
        }
        $iosMask.on('click', hideActionSheet);
        $iosMasks.on('click', hideActionSheet);
        $iosMaskPolice.on('click', hideActionSheet);
        $iosMaskFire.on('click', hideActionSheet);
        $('#iosActionsheetCancel').on('click', hideActionSheet);
        $('#iosActionsheetCancels').on('click', hideActionSheet);
        $('#iosActionsheetCancel-police').on('click', hideActionSheet);
        $('#iosActionsheetCancel-fire').on('click', hideActionSheet);
        var cid =  $('#container').data('data-company-name-cid');
        function load() {
            $.ajax({
                type: "POST",
                url: "api/company/detail.json",
                data:{id:cid,userid:$('#userid').val()},
                success: function (data) {
                    lists(data);
                },
                error: function (mes) {
                    $('#error').css("display","block");
                }
            });
        }
        load();
        $('#change').on('touchstart',function(e){
            var left = e.touches[0].pageX;
            var top = e.touches[0].pageY;
            e.preventDefault();
            $('body').on('touchmove',function(e){
                var x = e.touches[0].clientX-25;
                var y = e.touches[0].clientY-25;
                $('#change').css('left',x + "px");
                $('#change').css('top',y + "px")
            });
            $('#change').on('touchend',function(e){
                var endX = e.changedTouches[0].pageX;
                var endY= e.changedTouches[0].pageY;
                var moveX = left - endX;
                var moveY = top -endY;
                $('body').unbind();
                if(moveX==0&&moveY==0){
                    changeClick();
                }
            });
        });
        $('#change').on('mousedown',function(e){
            var _event = window.event||e;
            var left = _event.offsetX;
            var top = _event.offsetY;
            var downX = _event.pageX;
            var downY = _event.pageY;
            _event.preventDefault();
            $('body').on('mousemove',function(e){
                var _event = window.event||e;
                var x = _event.clientX-left;
                var y = _event.clientY-top;
                $('#change').css('left',x + "px");
                $('#change').css('top',y + "px")
            });
            $('#change').on('mouseup',function(e){
                $('body').unbind();
                var upX = e.pageX;
                var upY = e.pageY;
                var moveX = downX - upX;
                var moveY = downY - upY;
                if(moveX==0&&moveY==0){
                    changeClick();
                }

            });
        });
        function changeClick() {
            $('.bd-right').css('margin-right','25px');
            $('.icon-go-width').show();
            $('.link-delete').show();
            $('#change').hide();
            $('.link-alert').addClass('link-man');
            $('#empty-name').on('click',function(){
                $('#input-change').val('');
                $('#input-change').focus();
            });
            $('#empty-place').on('click',function(){
                $('#textarea-place').val('');
                $('#textarea-place').focus();
            });
            $('#look').html('<a class="btn" href="javascript:" id="save" data-id="">保存</a>');
            var txt = $('#company-name').text();
            var txt1= $('#company-place').text();
            $('#company-name').html('<input class="input-change" type="text" value="'+txt+'" id="input-change"/>');
            $('#company-place').html('<input class="input-change" type="text" id="textarea-place" value="'+txt1+'"/>');
            var changeval = $('#input-change').val();
            $('#input-change').val(changeval);
            //选择企业分类
            $('#classify').on('click',function(){
                $('#choice-list').html('');
                $.ajax({
                    type: "POST",
                    url: "api/companyType.json",
                    data:{userid:$('#userid').val()},
                    success: function (data) {
                        for(var i = 0;i<data.length;i++){
                            $('#choice-list').append('<div class="weui-actionsheet__cell type-choice-name" id='+data[i].id+'>'+data[i].name+'</div>');
                        }
                        $iosActionsheet.addClass('weui-actionsheet_toggle');
                        $iosMask.fadeIn(200);
                        $('.type-choice-name').on('click',function(){
                            $('#classify').html($(this).text());
                            var typeId = $(this).attr('id');
                            $('#container').data('data-add-typeId',typeId);
                            hideActionSheet();
                        });
                    },
                    error: function (mes) {
                        console.log("error");
                    }
                });
            });
            //选择辖区
            $.ajax({
                type: "POST",
                url: "api/user/policeHadArea.json",
                data: {userid: $('#userid').val()},
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#choice-list-police').append('<div class="weui-actionsheet__cell police-choice-name" id=' + data[i].id + '>' + data[i].name + '</div>');
                    }
                },
                error: function () {
                    console.log("error");
                }
            });
            $('#police').on('click',function(){
                $iosActionsheetPolice.addClass('weui-actionsheet_toggle');
                $iosMaskPolice.fadeIn(200);
                $('.police-choice-name').on('click', function () {
                    $('#police').html($(this).text());
                    var policeId = $(this).attr('id');
                    $('#container').data('data-add-policeId', policeId);
                    if ($('#police').text() != '') {
                        $('#icon2').hide();
                    }
                    hideActionSheet();
                });
            });
            //选择消防等级
            $('#fire').on('click',function(){
                $iosActionsheetFire.addClass('weui-actionsheet_toggle');
                $iosMaskFire.fadeIn(200);
                $('.fire-choice-name').on('click',function(){
                    $('#fire').html($(this).text());
                    var fireId = $(this).data('fire');
                    $('#container').data('data-add-fireId',fireId);
                    if($('#fire').text()!=''){
                        $('#icon4').hide();
                    }
                    hideActionSheet();
                });
            });
            $('#group').on('click',function(){
                $iosActionsheets.addClass('weui-actionsheet_toggle');
                $iosMasks.fadeIn(200);
                $('.group-choice-name').on('click',function(){
                    $('#group').html($(this).text());
                    var groupId = $(this).data('group');
                    $('#container').data('data-add-groupId',groupId);
                    hideActionSheet();
                });
            });
            $('.blur').on('click',function(){
                $('#input-change,#textarea-place').blur();
            });
            //法人信息修改
            $('#legal-person').on('click',function(){
                $('#alert,#alertbackground').fadeIn(100);
                var legalPhone = $('#legal-phone').val();
                var legalCompanyNum = $('#legal-company-tel-num').val();
                var changeLegalname = $('#legal-name').text();
                var legalPersonCard = $('#legal-name').data('cardid');
                $('#legal-person-name').val(changeLegalname);
                var changelegalPhone = $('#mobile-num').text();
                $('#legal-phone').val(changelegalPhone);
                var changelegalCompanyNum = $('#tel-num').text();
                $('#legal-company-tel-num').val(changelegalCompanyNum);
                $('#IdCard').val(legalPersonCard);
                $('#new-save').on('click',function(){
                    $('#alert,#alertbackground').fadeOut(100);
                    var legalName = $('#legal-person-name').val();
                    $('#legal-name').html(legalName);
                    var legalPhone = $('#legal-phone').val();
                    $('#mobile-num').html(legalPhone);
                    var legalCompanyNum = $('#legal-company-tel-num').val();
                    $('#tel-num').html(legalCompanyNum);
                    var legalCard = $('#IdCard').val();
                    $('#legal-name').data('cardid',legalCard);
                    if(legalPhone.length != 0&&legalCompanyNum.length!=0){
                        $('#symbol').show();
                    }
                    if(legalPhone.length == 0&&legalCompanyNum.length!=0){
                        $('#symbol').hide();
                    }
                    if(legalPhone.length != 0&&legalCompanyNum.length==0){
                        $('#symbol').hide();
                    }
                });
                $('#dis-none2').on('click',function(){
                    $('#alert,#alertbackground').fadeOut(100);
                });
            });
            $('#news-change').after(
                    '<div class="add-line" id="add-linkman"><span class="add">+</span>新增联系人<img src="images/icon-go.jpg" class="lt-img"/></div>'
            );
            //删除及添加修改联系人
            $('#add-linkman').on('click',function(){
                $('#alert-person,#personbackground,#person-news-change-btn').fadeIn(100);
                $('#linkName,#linkPhone,#WeXin,#E-mail,#Work').val('');
                $('#prompt').hide();
                $('#dis-none').on('click',function(){
                    $('#alert-person,#personbackground,#person-news-change-btn').fadeOut(100);
                });
            });
            $('.link-man').on('click',function(){
                $('#prompt').hide();
                $('#alert-person,#changeground,#amend').fadeIn(100);
                $('#dis-none1').on('click',function(){
                    $('#alert-person,#changeground,#amend').fadeOut(100);
                });
                var manPan = $(this);
                var _this = $(this).find('.label-width');
                var _this_phone = $(this).find('.label-phone');
                $('#linkName').val(_this.text());
                $('#linkPhone').val(_this_phone.text());
                var weixin = $(this).data('weixin');
                if(weixin=='undefined'){
                    weixin='';
                }
                $('#WeXin').val(weixin);
                var email = $(this).data('email');
                if(email=='undefined'){
                    email='';
                }
                $('#E-mail').val(email);
                $('#WeXin').val(weixin);
                var post = $(this).data('post');
                if(post=='undefined'){
                    post='';
                }
                $('#Work').val(post);
                $('#amend-new').on('click',function(){
                    var linkmanName = $('#linkName').val();
                    var linkPhone = $('#linkPhone').val();
                    var WeXin = $('#WeXin').val();
                    var Email = $('#E-mail').val();
                    var Work = $('#Work').val();
                    var pattern = /^1[34578]\d{9}$/;
                    var email = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
                    if(linkmanName.length==0||linkPhone.length==0){
                        $('#prompt').html('请输入必填项');
                        $('#prompt').fadeIn(100);
                        setTimeout(function () {
                            $('#prompt').fadeOut(100);
                        }, 2000);
                    }else if(pattern.test(linkPhone)==false){
                        $('#prompt').html('请输入正确的手机号码');
                        $('#prompt').fadeIn(100);
                        setTimeout(function () {
                            $('#prompt').fadeOut(100);
                        }, 2000);
                    }else if(Email.length!=0){
                        if(email.test(Email)==false){
                            $('#prompt').html('请输入正确的邮箱账号');
                            $('#prompt').fadeIn(100);
                            setTimeout(function () {
                                $('#prompt').fadeOut(100);
                            }, 2000);
                        }else{
                            _this.html($('#linkName').val());
                            _this_phone.html($('#linkPhone').val());
                            $('#alert-person,#changeground,#amend').fadeOut(100);
                            motifyMan(manPan);
                        }
                    }else{
                        _this.html($('#linkName').val());
                        _this_phone.html($('#linkPhone').val());
                        $('#alert-person,#changeground,#amend').fadeOut(100);
                        motifyMan(manPan);
                    }
                });
            });
            $('#default').on('click',function(){
                $('#androidDialog2').fadeOut(200);
            });
            $('.link-delete').on('click',function(){
                var _this = $(this);
                var dele =_this.siblings('.link-man').attr('id');
                $('#container').data('data-link-dele',dele);
                $('#androidDialog2').fadeIn(200);
                $('#dialog').html('确定删除该联系人');
                $('#dele-new').html('');
                $('#primary').on('click',function(){
                    $('#androidDialog2').fadeOut(200);
                    _this.parent().remove();
                    $('#dele-new').append(_this.parent().html());
                });
            });
            $('#save').on('click',function(){
                $('.bd-right').css('margin-right','0');
                $('.icon-go-width').hide();
                $('link-delete').hide()
                $('#classify').unbind();
                $('#group').unbind();
                $('#legal-person').unbind();
                $('#add-linkman').unbind();
                $('#add-linkman').hide();
                $('#change').show();
                $('#look').html(' <a class="btn" href="javascript:" id="showToast" data-id="police-company_list">查看从业人员列表</a>');
                $('#maskbox').hide();
                var text = $('#input-change').val();
                var text1 = $('#textarea-place').val();
                $('#company-name').html(text);
                $('#company-place').html(text1);
                $('.link-alert').removeClass('link-man');
                Toast();
                var inputChange = $('#company-name').text();
                var inputplace = $('#company-place').text();
                var type = $('#container').data('data-add-typeId');
                if(type==null){
                    type = $('#classify').data('types');
                }
                var police = $('#container').data('data-add-policeId');
                if(police==null){
                    police = $('#police').data('polices');
                }
                var group = $('#container').data('data-add-groupId');
                if(group==null){
                    group =  $('#group').data('groups');
                }
                var fire = $('#container').data('data-add-fireId');
                if(fire==null){
                    fire = $('#fire').data('fires');
                }
                var legalPersonName= $('#legal-person-name').val();
                var legalPersonPhone= $('#legal-phone').val();
                var legalPersonMobile= $('#legal-company-tel-num').val();
                var legalPersonCard = $('#IdCard').val();
                $('#form-box').html(
                        '<input name="id" value="'+cid+'"/>'+
                        '<input name="name" value="'+inputChange+'"/>'+
                        '<input name="address" value="'+inputplace+'"/>'+
                        '<input name="type" value="'+type+'"/>'+
                        '<input name="police" value="'+police+'"/>'+
                        '<input name="groupType" value="'+group+'"/>'+
                        '<input name="fireState" value="'+fire+'"/>'+
                        '<input name="legalPersonName" value="'+legalPersonName+'"/>'+
                        '<input name="legalPersonPhone" value="'+legalPersonPhone+'"/>'+
                        '<input name="legalPersonMobile" value="'+legalPersonMobile+'"/>'+
                        '<input name="legalPersonCard" value="'+legalPersonCard+'"/>'+
                        '<div id="add-list-name"></div>'+
                        '<div id="dele-box"></div>'
                );
                var $dele = $('#dele-new');
                $dele.find('.link-alert').each(function(i){
                    var delId = $(this).attr('id');
                    if(delId!=null){
                        $('#dele-box').append('<input name="del['+i+']" value="'+delId+'"/>');
                    }
                });
                var oldLength = $('#link-box .old-link').length;
                $('#link-box').find('.link-alert').each(function(i){
                    var manLink = $(this);
                    var name = manLink.data('name');
                    var phone = manLink.data('phone');
                    var WeXin = manLink.data('weixin');
                    var Email = manLink.data('email');
                    var Work = manLink.data('post');
                    var id = $(this).attr('id');
                    var j = i-oldLength;
                    var object = 'upt['+i+']';
                    if(id==null){
                        object = 'add['+j+']';
                    }else{
                        $('#add-list-name').append('<input name="'+object+'.id" value="'+id+'"/>');
                    }
                    if(name!=null){
                        $('#add-list-name').append('<input name="'+object+'.name" value="'+name+'"/>');
                    }
                    if(phone!=null){
                        $('#add-list-name').append('<input name="'+object+'.mobile" value="'+phone+'"/>');
                    }
                    if(WeXin!=null){
                        $('#add-list-name').append('<input name="'+object+'.wid" value="'+WeXin+'"/>');
                    }
                    if(Email!=null){
                        $('#add-list-name').append('<input name="'+object+'.email" value="'+Email+'"/>');
                    }
                    if(Work!=null){
                        $('#add-list-name').append( '<input name="'+object+'.post" value="'+Work+'"/>');
                    }
                });
                var json = $('#form-box').serialize();
                $.ajax({
                    type: "post",
                    url: "api/company/update.json?userid="+$('#userid').val(),
                    data:json,
                    success: function (xhr) {
                        if(xhr && xhr.state == 0){
                            $dele.html('');
                            $('#notNull').hide();
                            $('.cells-ajax').html('');
                            load();
                        }else{
                            $('#prompt').html('更新失败');
                            $('#prompt').show();
                        }
                    },
                    error: function () {
                        $('#prompt').html('更新失败');
                        $('#prompt').show();
                    }
                });
            });
        }

        function motifyMan(manPan){
            var linkmanName = $('#linkName').val();
            var linkPhone = $('#linkPhone').val();
            var WeXin = $('#WeXin').val();
            var Email = $('#E-mail').val();
            var Work = $('#Work').val();
            manPan.data('name',linkmanName);
            manPan.data('phone',linkPhone);
            manPan.data('weixin',WeXin);
            manPan.data('email',Email);
            manPan.data('post',Work);
        }

        function lists(data) {
            var address = data.company.address;
            address = address==null?'':address;
            var company = data.company.name;
            var type = data.company.type.name;
            var police = data.company.police.name;
            var groupType = data.company.groupType;
            var fireState = data.company.fireState;
            var legalPersonCard = data.company.legalPersonCard;
            var legalPersonName = data.company.legalPersonName;
            var legalPersonPhone = data.company.legalPersonPhone;
            var legalPersonMobile = data.company.legalPersonMobile;
            var group = '未选择';
            if(groupType==0){
                group = '普通';
            }else if(groupType==1){
                group = '其他';
            }
            var fire = '';
            if(fireState==0){
                fire = '非重点消防单位';
            }else if(fireState==1){
                fire = '重点消防单位';
            }
            if(legalPersonName==null){
                legalPersonName='';
            }
            if(legalPersonCard==null){
                legalPersonCard='';
            }
            if(legalPersonPhone==null){
                legalPersonPhone='';
            }
            if(legalPersonMobile==null){
                legalPersonMobile='';
            }
            company = company==null?'':company;
                var html =      '<div id="news-change">'+
                                '<div class="head-title">基本信息</div>'+
                                '<div class="none-flex cell-border cell-margin">'+
                                '<div class="weui-cell__hd"><label class="weui-label">企业名称</label></div>'+
                                '<div class="weui-cell__bd bd-right" id="company-name">'+
                                company+
                                '</div>'+
                                '<img src="images/empty.png" class="icon-go-width" id="empty-name"/> '+
                                '</div>'+
                                '<div class="none-flex cell-border cell-margin">'+
                                '<div class="weui-cell__hd"><label class="weui-label">企业地址</label></div>'+
                                '<div class="weui-cell__bd bd-right place-top" id="company-place">'+
                                address+
                                '</div>'+
                                '<img src="images/empty.png" class="icon-go-width" id="empty-place"/> '+
                                '</div>'+
                                '<div class="none-flex cell-border cell-margin">'+
                                '<div class="weui-cell__hd"><label class="weui-label">企业分类</label></div>'+
                                '<div class="weui-cell__bd bd-right blur" id="classify" data-types="'+ data.company.type.id+'">'+
                                type+
                                '</div>'+
                                '<img src="images/icon-go.jpg" class="icon-go-width"/> '+
                                '</div>'+
                                '<div class="none-flex cell-border cell-margin">'+
                                    '<div class="weui-cell__hd"><label class="weui-label">辖区民警</label></div>'+
                                    '<div class="weui-cell__bd bd-right blur" id="police" data-polices="'+ data.company.police.id+'">' +
                                police+
                                '</div>'+
                                '<img src="images/icon-go.jpg" class="icon-go-width"/> '+
                                '</div>'+
                                '<div class="none-flex cell-border cell-margin">'+
                                '<div class="weui-cell__hd"><label class="weui-label">企业组别</label></div>'+
                                '<div class="weui-cell__bd bd-right blur" id="group"  data-groups="'+groupType+'">'+
                                group+
                                '</div>'+
                                '<img src="images/icon-go.jpg" class="icon-go-width"/> '+
                                '</div>'+
                                '<div class="none-flex cell-border cell-margin head-title-border">'+
                                    '<div class="weui-cell__hd"><label class="weui-label">消防等级</label></div>'+
                                    '<div class="weui-cell__bd bd-right blur" id="fire" data-fires="'+fireState+'">' +
                                fire+
                                '</div>'+
                                '<img src="images/icon-go.jpg" class="icon-go-width"/> '+
                                '</div>'+
                                '<div class="head-title">法人</div>'+
                                '<div class="none-flex cell-border cell-margin head-title-border" id="legal-person">'+
                                '<div class="weui-cell__hd"><label class="weui-label" id="legal-name" data-cardid="'+legalPersonCard+'">'+legalPersonName+'</label></div>'+
                                '<div class="weui-cell__bd bd-right">'+
                                '<span id="mobile-num">'+legalPersonPhone+'</span><span id="symbol">/</span><span id="tel-num">'+legalPersonMobile+'</span>'+
                                '</div>'+
                                '<img src="images/icon-go.jpg" class="icon-go-width"/> '+
                                '</div>'+
                                '<div class="head-title">联系人</div>'+
                                '<div id="link-box">';
            var users = data.users,wid,email,post;
                                for(var i=0;i<users.length;i++){
                                    wid = users[i].wid;
                                    wid = wid == null ? '':' data-weixin="'+wid+'"';
                                    email = users[i].email;
                                    email = email == null ? '':' data-email="'+email+'"';
                                    post = users[i].post;
                                    post = post == null ? '':' data-post="'+post+'"';
                                    html +=
                                    '<div class="link-news-box">'+
                                    '<div class="none-flex cell-border cell-margin link-alert old-link"  data-name="'+users[i].name+'" data-phone="'+users[i].mobile+'" '+wid+email+post+' id="'+users[i].id+'">' +
                                    '<div class="weui-cell__hd"><label class="weui-label label-width">'+users[i].name+'</label></div>' +
                                    '<div class="weui-cell__bd bd-right label-phone" >' +
                                        users[i].mobile +
                                    '</div>' +
                                    '</div>'+
                                    '<div class="link-delete ">×</div>'+
                                    '</div>'
                                }
                                html += '</div>';
                html += '</div>';
            $('.cells-ajax').append(html);
            if($('#mobile-num').text()==''){
                $('#symbol').hide();
            }
            if($('#tel-num').text()==''){
                $('#symbol').hide();
            }
        }
        $('#news-save').on('click',function(){
            var linkmanName = $('#linkName').val();
            var linkPhone = $('#linkPhone').val();
            var WeXin = $('#WeXin').val();
            var Email = $('#E-mail').val();
            var Work = $('#Work').val();
            var pattern = /^1[34578]\d{9}$/;
            var email = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if(linkmanName.length==0||linkPhone.length==0){
                $('#prompt').html('请输入必填项');
                $('#prompt').show();
                setTimeout(function () {
                    $('#prompt').fadeOut(100);
                }, 2000);
            }else if(pattern.test(linkPhone)==false){
                $('#prompt').html('请输入正确的手机号码');
                $('#prompt').show();
                setTimeout(function () {
                    $('#prompt').fadeOut(100);
                }, 2000);
            }else if(Email.length!=0){
                if(email.test(Email)==false){
                    $('#prompt').html('请输入正确的邮箱账号');
                    $('#prompt').show();
                    setTimeout(function () {
                        $('#prompt').fadeOut(100);
                    }, 2000);
                }else{
                    Link();
                }
            } else{
                Link();
            }
            function Link(){
                var html =
                        '<div class="link-news-box">'+
                        '<div class="none-flex cell-border cell-margin link-alert link-man" data-name="'+linkmanName+'" data-phone="'+linkPhone+'" data-weixin="'+WeXin+'" data-email="'+Email+'" data-post="'+Work+'">'+
                        '<div class="weui-cell__hd"><label class="weui-label label-width">'+linkmanName+'</label></div>'+
                        '<div class="weui-cell__bd bd-right label-phone right-mar">'+
                        linkPhone+
                        '</div>'+
                        '</div>'+
                        '<div class="link-delete block">×</div>'+
                        '</div>'
                $('#link-box').append(html);
                $('#alert-person,#personbackground,#person-news-change-btn').fadeOut(100);
                $('#default').on('click',function(){
                    $('#androidDialog2').fadeOut(200);
                });
                $('.link-delete').on('click',function(){
                    var _this = $(this);
                    var dele =_this.siblings('.link-man').attr('id');
                    $('#container').data('data-link-dele',dele);
                    $('#androidDialog2').fadeIn(200);
                    $('#dialog').html('确定删除该联系人');
                    $('#dele-new').html('');
                    $('#primary').on('click',function(){
                        $('#androidDialog2').fadeOut(200);
                        _this.parent().remove();
                        $('#dele-new').append(_this.parent().html());
                    });
                });
            }
        });
        function  Toast() {
            $('#showToast').on('click',function(){
                $('#container').data('data-list-employee-val',null);
                $('#container').data('data-company-name-cid',cid);
                var id = $('.btn-box').data('id');
                $('#taskId').val($(this).data('tid'));
                window.pageManager.go(id);
            })
        }
        Toast();
    })
</script>
